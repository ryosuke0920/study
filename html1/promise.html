<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Promise</title>
</head>

<body>
	<script>
		class Hoge {
			main() {
				console.log('main');
				const url = 'promise.json';
				const url2 = 'http://google.comm/promise.json';

				// this.fetch(url);

				// this.fetch2(url).then(e=>{
				// 	console.log(e);
				// });

				// this.fetch3(url).then(e=>console.log(e));

				// this.fetch4(url, url2).then(e=>{
				// 	console.log(e);
				// });

				// this.wait(3).then(()=>{console.log("3")});
			}

			async wait(sec){
				return new Promise(resolve=>{
					setTimeout( resolve, sec * 1000);
				})
			}

			async fetch4(url, url2){
				const list = await Promise.all([fetch(url), fetch(url2)]).then(arr=>{
					return Promise.all([arr[0].json(), arr[1].json()]);
				});
				return list[0].data.concat(list[1].data);
			}

			async fetch3(url){
				return "Hello";
			}

			async fetch2(url){
				try{
					const result = await fetch(url);
					const json = await result.json();
					return json.data;
				}
				catch(e){
					console.log('catch');
					console.log(e);
				}
				finally{
					console.log('finally');
				}
			}

			fetch(url){
				let promise = fetch(url);
				promise = this.chain(promise);
				promise.then(e=>{
					console.log("ok");
					return e['data'];
				}).then(e=>{
					console.log(e);
					// return 'successed';
					throw new Error('errored');
				}).catch(e=>{
					console.log(e);
					return "catched.";
				}).then(e=>{
					console.log(e);
				});
			}

			chain(promise){
				promise = promise.then(
					e => {
						console.log('sucess');
						return e.json();
					},
					e => {
						console.log('error');
						// throw new Error("test");
					},
				).catch(e=>{
					console.log('catch');
				}).finally(e=>{
					console.log('finally');
				});
				return promise;
			}
		}
		const hoge = new Hoge();
		hoge.main();
	</script>
</body>

</html>